% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/limma4functional.R
\name{limma4functional}
\alias{limma4functional}
\title{Differential Pathway Abundance Analysis Using limma}
\usage{
limma4functional(
  df2,
  metad2,
  interestvar = "Condition",
  covars = c(),
  form = NULL,
  make_all_contrasts = FALSE
)
}
\arguments{
\item{df2}{A data frame of quantitative pathway abundances. The first column must be named "Pathway" and contain pathway identifiers. Subsequent columns represent samples, with column names matching sample IDs in \code{metad2}.}

\item{metad2}{A data frame of sample metadata, with at least columns \code{sampleID} (matching \code{df2} columns) and the grouping variable specified in \code{interestvar}. May also include covariates.}

\item{interestvar}{Character string specifying the main factor variable in \code{metad2} to test differences across (default is \code{"Condition"}).}

\item{covars}{Character vector of covariate column names in \code{metad2} to adjust for in the model (default is empty vector, meaning no covariates).}

\item{form}{Optional custom model formula as a string or formula object for design matrix construction. If \code{NULL} (default), a formula is automatically created from \code{interestvar} and \code{covars}.}

\item{make_all_contrasts}{Logical, whether to compute all possible contrasts between factor levels rather than only the main contrast (default \code{FALSE}).}
}
\value{
A data frame of differential abundance statistics for the main contrast if \code{make_all_contrasts = FALSE}. If \code{TRUE}, returns a named list of such data frames, one per contrast.
}
\description{
Performs differential abundance testing on pathway-level quantitative data using linear modeling and empirical Bayes moderation via the limma package.
}
\details{
This function analyzes functional pathway abundance data (or other similar expression-like matrices) to identify differentially abundant pathways between experimental groups.

The procedure follows these steps:
\enumerate{
\item Metadata rows with missing values (\code{NA}) in specified covariates are filtered out to ensure clean modeling.
\item The abundance data frame (\code{df2}) is converted to a numeric matrix with pathways as rows and samples as columns. Samples are reordered to match the metadata order.
\item A log-transformation (\code{log(x + 1)}) is applied to stabilize variance and reduce skewness.
\item The main variable of interest (\code{interestvar}) in \code{metad2} is coerced to a factor.
\item If no formula is provided, a design formula is built automatically, modeling the main variable without an intercept and including covariates if specified.
\item A design matrix is generated from the formula and metadata, encoding the experimental design.
\item A linear model is fit to the log-transformed data using limma's \code{lmFit}.
\item A contrast matrix is constructed to compare two groups: specifically, \code{Depression} versus \code{Control} (hardcoded, modify as needed).
\item The contrast is applied, and empirical Bayes moderation (\code{eBayes}) is performed to improve variance estimation.
\item A top table of statistics is extracted, including log2 fold changes, average expression, moderated t-statistics, raw and adjusted p-values, and log-odds scores.
\item If requested, the function computes differential statistics for all other contrasts between groups, returning a list of results.
}

\strong{Note:} The contrast definitions are currently hardcoded and may require modification for custom group names or additional contrasts.
}
\examples{
\dontrun{
if(interactive()){
  # Example input data preparation
  df2 <- data.frame(Pathway = c("PWY1", "PWY2"),
                    Sample1 = c(10, 5),
                    Sample2 = c(20, 15),
                    Sample3 = c(8, 3),
                    Sample4 = c(1, 13))
  metad2 <- data.frame(sampleID = c("Sample1", "Sample2", "Sample3", "Sample4"),
                      Condition = c("Control", "Depression", "Control", "Depression"))

  # Run differential abundance analysis
  results <- limma4functional(df2, metad2, interestvar = "Condition")
  head(results)
}
}

}
\seealso{
\code{\link[dplyr]{filter}}, \code{\link[limma]{lmFit}}, \code{\link[limma]{makeContrasts}}, \code{\link[limma]{eBayes}}, \code{\link[limma]{topTable}}
}
