% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/makeFullMediationAnalysisIMC_Aggregate.R
\name{makeFullMediationAnalysisIMC_Aggregate}
\alias{makeFullMediationAnalysisIMC_Aggregate}
\title{Perform Full Mediation Analysis Aggregated by IMC (BMI)}
\usage{
makeFullMediationAnalysisIMC_Aggregate(
  opt,
  getVarsFunctions,
  mediator_name = "IMC",
  y_name = "Condition_bin",
  plim = 0.05,
  plim_plot = 0.05,
  name = "analysis_IMC_separateModel_vjust",
  wnet = 14,
  hnet = 12,
  wbars = 8,
  hbars = 10,
  wbars2 = 10,
  hbars2 = 12,
  use_color_scale = FALSE,
  fix_barplot_limits = FALSE,
  custom_colors = NULL
)
}
\arguments{
\item{opt}{A list or object containing parameters and paths, including an output directory path in \code{opt$out}.}

\item{getVarsFunctions}{A function that, given a data frame of merged p-values, returns a character vector
of variable names selected for mediation analysis.}

\item{mediator_name}{Name of the mediator variable (default: "IMC").}

\item{y_name}{Name of the binary outcome variable (default: "Condition_bin").}

\item{plim}{P-value cutoff for filtering variables in the mediation analysis (default: 0.05).}

\item{plim_plot}{P-value cutoff for plotting significance (default: 0.05).}

\item{name}{Prefix name used in output plot filenames (default: "analysis_IMC_separateModel_vjust").}

\item{wnet}{Width of network plot in inches (default: 14).}

\item{hnet}{Height of network plot in inches (default: 12).}

\item{wbars}{Width of bar plots in inches (default: 8).}

\item{hbars}{Height of bar plots in inches (default: 10).}

\item{wbars2}{Width of alternative bar plots in inches (default: 10).}

\item{hbars2}{Height of alternative bar plots in inches (default: 12).}

\item{use_color_scale}{Logical; whether to use a color scale in plots (default: FALSE).}

\item{fix_barplot_limits}{Logical; whether to fix limits in bar plots (default: FALSE).}

\item{custom_colors}{Optional vector of custom colors for plotting (default: NULL).}
}
\value{
A list containing:
\itemize{
\item \code{plotNet}: Network plot object generated by \code{plotIMCMediationSimple}.
\item \code{barplots}: A list of bar plot objects showing correlation and effects by species.
\item \code{res_final}: Data frame of the final mediation analysis results.
}
}
\description{
This function performs a comprehensive mediation analysis exploring the effect of variables on a binary outcome
(e.g., disease condition) mediated by an intermediate variable (default "IMC", e.g., BMI).
It merges differential expression analysis (DEA) results, filters variables for mediation testing,
computes mediation effects, and generates plots including histograms and species-specific correlation plots.
The results are saved to disk as TSV and RData files.
}
\details{
The function proceeds through several key steps:
\enumerate{
\item Cleans variable names in the data to harmonize them for merging.
\item Merges adjusted p-values from multiple DEA contrasts.
\item Selects variables to test for mediation based on user-supplied \code{getVarsFunctions}.
\item Performs simple mediation analysis for each variable using the \code{makeMediationSimple} function.
\item Adjusts p-values for multiple testing if \code{AJUST_PVALS} is TRUE.
\item Generates histograms and species-specific correlation and effect plots.
\item Saves all results and plots in the specified output directory.
}
}
\examples{
\dontrun{
if(interactive()){
  opt <- list(out = "results/")
  getVarsFunctions <- function(df) {
    df$variable[df$depr_only_padj < 0.05]
  }
  results <- makeFullMediationAnalysisIMC_Aggregate(opt, getVarsFunctions)
}
}

}
\seealso{
\code{\link[assertthat]{assert_that}},
\code{\link[dplyr]{select}}, \code{\link[dplyr]{filter}}, \code{\link[dplyr]{summarise_all}}, \code{\link[dplyr]{mutate}},
\code{\link[tidyr]{unite}}
}
